<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACME: src/lemma_extraction/extraction_functions.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACME
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">ACME: Automated Collection and Manipulation of Email</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lemma__extraction_2extraction__functions_8py_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">extraction_functions.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lemma__extraction_2extraction__functions_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html">    1</a></span>&#160;<span class="comment"># importing builtin packages</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> json</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> string</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> typing <span class="keyword">import</span> Union, AnyStr</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># importing nltk packages</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">from</span> nltk.stem <span class="keyword">import</span> WordNetLemmatizer</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># importing sci-kit package&#39;s tools for processing text</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># importing container/data-structure and plotting packages</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># custom codebase imports</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">from</span> src <span class="keyword">import</span> TABLE_NAMES</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> src <span class="keyword">import</span> project_root_folder</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">from</span> .cache_class_defs <span class="keyword">import</span> LemmaDB, lemma_table_row</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">from</span> .word_extraction_classes <span class="keyword">import</span> LemmaExtractor</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacesrc_1_1utils_1_1custom__logger.html">src.utils.custom_logger</a> <span class="keyword">import</span> get_logger, CallStackFormatter</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacesrc_1_1body__extraction_1_1cache__class__defs.html">src.body_extraction.cache_class_defs</a> <span class="keyword">import</span> MessageBodyDB,body_table_row</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># creating global namespace variables</span></div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#ac28207c6b2698138d25376a7f42f6855">   24</a></span>&#160;info = <a class="code" href="namespacesrc_1_1utils_1_1backup_1_1custom__logger.html#ae2dfd7172766d01197bea623a3e9ea9f">get_logger</a>(<span class="stringliteral">&quot;EmailClassifier&quot;</span>,__name__+<span class="stringliteral">&quot;: lemma extraction status&quot;</span>,level=<span class="stringliteral">&quot;INFO&quot;</span>)</div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#abf6b3c006a357356aafb57d0d5e034fb">   25</a></span>&#160;unexpected_values_logger = <a class="code" href="namespacesrc_1_1utils_1_1backup_1_1custom__logger.html#ae2dfd7172766d01197bea623a3e9ea9f">get_logger</a>(<span class="stringliteral">&quot;EmailClassifier&quot;</span>,__name__+<span class="stringliteral">&quot;: unexpected values&quot;</span>,formatter=CallStackFormatter,level=<span class="stringliteral">&quot;WARNING&quot;</span>)</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#a1ede26da74b5beaf9f4395d8735190c3">   26</a></span>&#160;inpt_file_encoding = <span class="stringliteral">&quot;UTF-8&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">########################################################################################################################</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># Keyword extraction functions</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">########################################################################################################################</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#ae24c215acf41c6b0793a734d3baa9067">   34</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#ae24c215acf41c6b0793a734d3baa9067">extract_lemma</a>(targets:list, file_dep:list)-&gt;tuple:</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    lemmatizer_ref = WordNetLemmatizer()</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment"># stopwords_set = set(stopwords.words(&quot;english&quot;))</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    stopwords_set = {<span class="stringliteral">&quot;the&quot;</span>,<span class="stringliteral">&quot;be&quot;</span>,<span class="stringliteral">&quot;to&quot;</span>,<span class="stringliteral">&quot;a&quot;</span>}</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment"># stopwords_set = {}</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    excluded_punctuation = string.punctuation</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment"># excluded_punctuation = &quot;.,&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    email_db_path = Path(file_dep.pop())</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    body_db_path = Path(file_dep.pop())</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    lemma_db_path = Path(targets.pop())</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment"># keyword_extraction_path = Path(targets[0])</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment"># keyword_extraction_path.mkdir(parents=True,exist_ok=True)</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    message_bodies = [[],[[],[]],[[],[]],[]]</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment"># tagged_sentences = []</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    extractors = []</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">with</span> <a class="code" href="classsrc_1_1body__extraction_1_1cache__class__defs_1_1_message_body_d_b.html">MessageBodyDB</a>(body_db_path, TABLE_NAMES[<span class="stringliteral">&quot;body&quot;</span>])(<span class="stringliteral">&quot;main&quot;</span>) <span class="keyword">as</span> body_db:</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">with</span> <a class="code" href="classsrc_1_1lemma__extraction_1_1cache__class__defs_1_1_lemma_d_b.html">LemmaDB</a>(lemma_db_path,TABLE_NAMES[<span class="stringliteral">&quot;lemma&quot;</span>])(<span class="stringliteral">&quot;main&quot;</span>) <span class="keyword">as</span> lemma_db:</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            <span class="comment"># curs,curs_pos = lemma_db.cursor</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            all_lemma = lemma_db.table_names[0]</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            no_stops_lemma = lemma_db.table_names[1]</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            existing_lemma = {k:set() <span class="keywordflow">for</span> k <span class="keywordflow">in</span> lemma_db.table_names}</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            row:lemma_table_row</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">for</span> table_name,row <span class="keywordflow">in</span> lemma_db.select(column_names=<span class="stringliteral">&quot;id&quot;</span>):</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                existing_lemma[table_name].add(row.id)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            row:body_table_row</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            <span class="keywordflow">for</span> table_name, row <span class="keywordflow">in</span> body_db.select(column_names=[<span class="stringliteral">&quot;id,processed_body&quot;</span>]):</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                doc_id = row.id</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                body_text = row.processed_body</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                keyword_extractor = <a class="code" href="classsrc_1_1lemma__extraction_1_1word__extraction__classes_1_1_lemma_extractor.html">LemmaExtractor</a>(doc_id,body_text, excluded_punctuation, stopwords_set, lemmatizer_ref)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                extractors.append(keyword_extractor)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                <span class="keywordflow">if</span> doc_id <span class="keywordflow">not</span> <span class="keywordflow">in</span> existing_lemma[all_lemma]:</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                    lemma_row_details = keyword_extractor.to_table_row_dict()</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                    lemma_db.add_row(all_lemma,<span class="stringliteral">&quot;main&quot;</span>,**lemma_row_details)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                <span class="keywordflow">if</span> doc_id <span class="keywordflow">not</span> <span class="keywordflow">in</span> existing_lemma[no_stops_lemma]:</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                    lemma_row_details = keyword_extractor.to_table_row_dict(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    lemma_db.add_row(no_stops_lemma, <span class="stringliteral">&quot;main&quot;</span>, **lemma_row_details)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            lemma_db.commit()</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="comment"># raw body text</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="comment"># message_bodies[0].append(body_text)</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="comment"># message_bodies[1][0].append(keyword_extractor.do_join(&quot;lemma&quot;, &quot; &quot;, (&quot;_^_&quot;, &quot;&#39;&quot;)))</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="comment"># message_bodies[1][1].append(keyword_extractor.lemma)</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="comment"># message_bodies[2][0].append(keyword_extractor.do_join(&quot;stopped_lemma&quot;, &quot; &quot;, (&quot;_^_&quot;, &quot;&#39;&quot;)))</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="comment"># message_bodies[2][1].append(keyword_extractor.stopped_lemma)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <span class="comment"># message_bodies[3].append(f&quot;Subject: &#39;{header[&#39;Subject&#39;]}&#39;&quot;)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    diagnostics = project_root_folder.joinpath(<span class="stringliteral">&quot;diagnostics&quot;</span>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    diagnostics.mkdir(parents=<span class="keyword">True</span>,exist_ok=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">with</span> open(diagnostics.joinpath(<span class="stringliteral">&quot;keyword_exctractors.json&quot;</span>),<span class="stringliteral">&quot;w&quot;</span>) <span class="keyword">as</span> ext_f:</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        json.dump([ext.to_json(4) <span class="keywordflow">for</span> ext <span class="keywordflow">in</span> extractors],ext_f,indent=4)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#a0dca05406d6cbaf6389e6572791c42c7">pandas_plotting_inspection</a>(lemma_db_path,email_db_path)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment"># with open()</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment"># _keyword_extraction_helper(message_bodies,keyword_extraction_path, False)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#a0dca05406d6cbaf6389e6572791c42c7">   86</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#a0dca05406d6cbaf6389e6572791c42c7">pandas_plotting_inspection</a>(lemma_db_path:Union[AnyStr,Path], email_db_path:Union[AnyStr,Path],do_plots:bool=<span class="keyword">True</span>):</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment"># import plotly.express as px</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    pd.options.display.max_columns = 20</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    pd.options.display.width = 400</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    pd.options.plotting.backend = <span class="stringliteral">&quot;plotly&quot;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">with</span> <a class="code" href="classsrc_1_1lemma__extraction_1_1cache__class__defs_1_1_lemma_d_b.html">LemmaDB</a>(lemma_db_path,TABLE_NAMES[<span class="stringliteral">&quot;lemma&quot;</span>]) <span class="keyword">as</span> lemma_db:</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keyword">with</span> lemma_db(<span class="stringliteral">&quot;email_db&quot;</span>,database=email_db_path):</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            column_names = lemma_db.column_names[<span class="stringliteral">&quot;all_lemma&quot;</span>]</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            column_names = <span class="stringliteral">&quot;,&quot;</span>.join(f<span class="stringliteral">&quot;t1.{cname}&quot;</span> <span class="keywordflow">for</span> cname <span class="keywordflow">in</span> column_names[1:])</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            agg_sql = f<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">                SELECT </span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral">                    t1.id,t2.subject,{column_names} </span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">                FROM </span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">                        main.all_lemma AS t1 </span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">                    JOIN </span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral">                        &#39;email_db&#39;.emails AS t2 </span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">                WHERE </span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">                    t1.id=t2.id;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">                &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            curs, curs_pos = lemma_db.cursor</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            curs.arraysize = 10</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            agg = []</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            curs.execute(agg_sql)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            batch = curs.fetchmany()</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">while</span> batch:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">for</span> res <span class="keywordflow">in</span> batch:</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    agg.append(res)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                batch = curs.fetchmany()</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment"># def build_count_dataframe(convert_normed_to_bell:bool=False):</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">#     word_bag[0]:csr_matrix</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">#     word_bag[1]:List[str]</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">#     df = pd.DataFrame(word_bag[0].T.toarray(), index=word_bag[1])</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">#     # add_stats_columns(df)</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">#     df = df.rename(columns={i: headers[i] for i in range(len(headers))},</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">#                    index={k: k.replace(&quot;__&quot;, &quot;&#39;&quot;) for k in df.index},</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">#                    errors=&quot;raise&quot;)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">#     df.insert(len(df.columns), &quot;All Documents&quot;, df.max(axis=1))</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">#     sortable_map = {k: df.loc[k, &quot;All Documents&quot;] for k in df.index}</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">#     df.sort_index(axis=0, inplace=True, key=lambda x: [sortable_map[i] for i in x])</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">#     df_normed: pd.DataFrame = df.copy()</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">#     df_max = df.sum(axis=0)</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">#     for col in df.columns:</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">#         df_normed[col] /= df_max[col]</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">#     if convert_normed_to_bell:</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">#         normed_as_bell_curve(df_normed)</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">#     return df,df_normed</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">#</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment"># def normed_as_bell_curve(df_normed):</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">#     # now we re-organize df_normed to show as a sort of bell-curve to give visual insight to the</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">#     # stdv and var of the word count distribution</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">#     normed_sortable_map = {}</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">#     indices = tuple(df_normed.index)</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">#     end = len(indices)-1</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">#     i = 0</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">#     try:</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">#         for idx in range(0,len(indices),2):</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">#             normed_sortable_map[indices[idx]] = i</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">#             normed_sortable_map[indices[idx+1]] = end-i</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">#             i += 1</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">#     except IndexError:</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">#         pass</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">#     df_normed.sort_index(axis=0, inplace=True, key=lambda x: [normed_sortable_map[i] for i in x])</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">#     return</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">#</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment"># def build_figure(df:pd.DataFrame,fig_title,xaxis_title,yaxis_title):</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">#     fig = go.Figure()</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">#     fig.update_layout(title=fig_title,</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">#                       font=dict(</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">#                           size=18</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">#                       ),</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">#                       legend=dict(</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">#                           yanchor=&quot;top&quot;,</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">#                           y=.99,</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">#                           xanchor=&quot;left&quot;,</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">#                           x=.01,</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">#                       ),</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">#                       plot_bgcolor=&quot;rgba(1,1,1,1)&quot;,</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">#                       hoverlabel={&quot;namelength&quot;:-1,</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">#                                   &quot;font_size&quot;:16,},</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">#                       hovermode=&quot;x unified&quot;,</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">#                       )</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">#     col:str</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">#     for t, col in zip(df.plot.bar().data, df.columns):</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">#         # name will drop the &#39;Subjec: &#39; portion of the column label as it&#39;s redundant in the plot legend</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">#         if col.startswith(&quot;Subject: &quot;):</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">#             name = col[col.find(&quot;: &quot;)+2:]</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">#             if len(name)&gt;30:</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">#                 name = name[:30]+&quot;...&quot;</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">#         else:</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">#             name = col</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">#         fig.add_bar(x=t.x, y=t.y, name=name)</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">#     # # edit axis labels</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">#     fig[&#39;layout&#39;][&#39;xaxis&#39;][&#39;title&#39;] = xaxis_title</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">#     fig[&#39;layout&#39;][&#39;yaxis&#39;][&#39;title&#39;] = yaxis_title</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">#     return fig</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">#</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment"># wb_df,wb_normed = build_count_dataframe()</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment"># path = out_path.joinpath(&quot;raw_word_count_matrix.csv&quot;)</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment"># if path.exists():</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">#     warning_logger.warning(&quot;Notice!!! We detected that the target csv name on our target path already exists, generating name with a unique id suffix now&quot;)</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">#     index = 0</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">#     path=path.with_name(f&quot;raw_word_count_matrix_{index}.csv&quot;)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">#     while path.exists():</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">#         index+=1</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">#         path = path.with_name(f&quot;raw_word_count_matrix_{index}.csv&quot;)</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment"># info.warning(f&quot;writing word count matrix to:\n\t\t{str(path)}&quot;)</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment"># wb_df.to_csv(str(path))</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment"># if do_plots:</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">#     fig1 = build_figure(wb_normed,</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">#                         f&quot;{context_str} Word count as ratios on range [0,1]&quot;,</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">#                         &#39;Unique words found in documents&#39;,</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">#                         &#39;Word count as ratio of (unique_word / sum(all_words))&#39;)</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">#     fig1.show()</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">#     fig2 = build_figure(wb_df,</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">#                         f&quot;{context_str} Raw word counts&quot;,</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">#                         &#39;Unique words found in documents&#39;,</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">#                         &#39;Raw word counts&#39;)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">#     fig2.show()</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="ttc" id="aclasssrc_1_1body__extraction_1_1cache__class__defs_1_1_message_body_d_b_html"><div class="ttname"><a href="classsrc_1_1body__extraction_1_1cache__class__defs_1_1_message_body_d_b.html">src.body_extraction.cache_class_defs.MessageBodyDB</a></div><div class="ttdef"><b>Definition:</b> <a href="body__extraction_2cache__class__defs_8py_source.html#l00019">cache_class_defs.py:19</a></div></div>
<div class="ttc" id="aclasssrc_1_1lemma__extraction_1_1cache__class__defs_1_1_lemma_d_b_html"><div class="ttname"><a href="classsrc_1_1lemma__extraction_1_1cache__class__defs_1_1_lemma_d_b.html">src.lemma_extraction.cache_class_defs.LemmaDB</a></div><div class="ttdef"><b>Definition:</b> <a href="lemma__extraction_2cache__class__defs_8py_source.html#l00018">cache_class_defs.py:18</a></div></div>
<div class="ttc" id="aclasssrc_1_1lemma__extraction_1_1word__extraction__classes_1_1_lemma_extractor_html"><div class="ttname"><a href="classsrc_1_1lemma__extraction_1_1word__extraction__classes_1_1_lemma_extractor.html">src.lemma_extraction.word_extraction_classes.LemmaExtractor</a></div><div class="ttdef"><b>Definition:</b> <a href="word__extraction__classes_8py_source.html#l00099">word_extraction_classes.py:99</a></div></div>
<div class="ttc" id="anamespacesrc_1_1body__extraction_1_1cache__class__defs_html"><div class="ttname"><a href="namespacesrc_1_1body__extraction_1_1cache__class__defs.html">src.body_extraction.cache_class_defs</a></div><div class="ttdef"><b>Definition:</b> <a href="body__extraction_2cache__class__defs_8py_source.html#l00001">cache_class_defs.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1lemma__extraction_1_1extraction__functions_html_a0dca05406d6cbaf6389e6572791c42c7"><div class="ttname"><a href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#a0dca05406d6cbaf6389e6572791c42c7">src.lemma_extraction.extraction_functions.pandas_plotting_inspection</a></div><div class="ttdeci">def pandas_plotting_inspection(Union[AnyStr, Path] lemma_db_path, Union[AnyStr, Path] email_db_path, bool do_plots=True)</div><div class="ttdef"><b>Definition:</b> <a href="lemma__extraction_2extraction__functions_8py_source.html#l00086">extraction_functions.py:86</a></div></div>
<div class="ttc" id="anamespacesrc_1_1lemma__extraction_1_1extraction__functions_html_ae24c215acf41c6b0793a734d3baa9067"><div class="ttname"><a href="namespacesrc_1_1lemma__extraction_1_1extraction__functions.html#ae24c215acf41c6b0793a734d3baa9067">src.lemma_extraction.extraction_functions.extract_lemma</a></div><div class="ttdeci">tuple extract_lemma(list targets, list file_dep)</div><div class="ttdoc">Keyword extraction functions.</div><div class="ttdef"><b>Definition:</b> <a href="lemma__extraction_2extraction__functions_8py_source.html#l00034">extraction_functions.py:34</a></div></div>
<div class="ttc" id="anamespacesrc_1_1utils_1_1backup_1_1custom__logger_html_ae2dfd7172766d01197bea623a3e9ea9f"><div class="ttname"><a href="namespacesrc_1_1utils_1_1backup_1_1custom__logger.html#ae2dfd7172766d01197bea623a3e9ea9f">src.utils.backup.custom_logger.get_logger</a></div><div class="ttdeci">logging.Logger get_logger(str root_name, str child_name=None, str header_label=None, Union[Formatter, str] formatter=None, Union[int, str] level=None, dict logger_registration_dict=None, handler_delegate=logging.StreamHandler, bool do_file_output=False, **handler_kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="backup_2custom__logger_8py_source.html#l00365">custom_logger.py:373</a></div></div>
<div class="ttc" id="anamespacesrc_1_1utils_1_1custom__logger_html"><div class="ttname"><a href="namespacesrc_1_1utils_1_1custom__logger.html">src.utils.custom_logger</a></div><div class="ttdef"><b>Definition:</b> <a href="custom__logger_8py_source.html#l00001">custom_logger.py:1</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_6b1ff5edbf926e004f86851e04bcf591.html">lemma_extraction</a></li><li class="navelem"><a class="el" href="lemma__extraction_2extraction__functions_8py.html">extraction_functions.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
